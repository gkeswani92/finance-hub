<div class="p-8">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h2 class="text-2xl font-bold text-gray-900"><%= @account.name %></h2>
      <p class="text-sm text-gray-500 mt-1">
        <%= @account.owner.name %> &middot; <%= @account.category.name %> &middot; <%= @account.institution %>
      </p>
    </div>
    <div class="flex gap-3">
      <%= link_to "Edit", edit_account_path(@account), class: "text-sm text-blue-600 hover:text-blue-800" %>
      <%= link_to "Back", accounts_path, class: "text-sm text-gray-500 hover:text-gray-700" %>
    </div>
  </div>

  <!-- Current Value -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
    <p class="text-sm font-medium text-gray-500">Current Value</p>
    <p class="text-3xl font-bold text-gray-900 mt-1">
      <%= format_currency(@account.latest_value, @account.currency) %>
    </p>
    <% if @account.cost_basis && @account.cost_basis > 0 %>
      <p class="text-sm text-gray-500 mt-2">
        Cost basis: <%= format_currency(@account.cost_basis, @account.currency) %>
      </p>
    <% end %>
  </div>

  <!-- Record New Value -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Record Value</h3>
    <%= form_with(model: [@account, ValueSnapshot.new], url: account_snapshots_path(@account)) do |f| %>
      <div class="flex gap-4 items-end">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
          <%= f.date_field :snapshot_date, value: Date.current, class: "rounded-lg border-gray-300 shadow-sm text-sm" %>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Value (<%= @account.currency %>)</label>
          <%= f.number_field :value, step: 0.01, class: "rounded-lg border-gray-300 shadow-sm text-sm", required: true %>
        </div>
        <%= f.submit "Save", class: "bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 cursor-pointer" %>
      </div>
    <% end %>
  </div>

  <!-- Value History Chart -->
  <% if @snapshots.any? %>
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Value History</h3>
      <div data-controller="account-history-chart"
           data-account-history-chart-data-value='<%= @snapshots.map { |s| { date: s.snapshot_date.to_s, value: s.value.to_f } }.to_json %>'
           class="h-64">
        <div data-account-history-chart-target="canvas"></div>
      </div>
    </div>
  <% end %>

  <!-- Snapshot Table -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
          <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Value</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <% @snapshots.each do |snapshot| %>
          <tr>
            <td class="px-6 py-4 text-sm text-gray-900"><%= snapshot.snapshot_date.strftime("%b %d, %Y") %></td>
            <td class="px-6 py-4 text-sm text-right font-medium text-gray-900">
              <%= format_currency(snapshot.value, @account.currency) %>
            </td>
          </tr>
        <% end %>
        <% if @snapshots.empty? %>
          <tr>
            <td colspan="2" class="px-6 py-8 text-center text-gray-500">No snapshots yet.</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
