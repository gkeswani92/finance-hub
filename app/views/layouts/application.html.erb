<!DOCTYPE html>
<html class="h-full">
  <head>
    <title>Finance Hub</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com/3.4.17"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'system-ui', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="h-full bg-[#f8f9fb] font-sans text-gray-900" data-controller="mobile-sidebar">
    <!-- Mobile sidebar overlay -->
    <div data-mobile-sidebar-target="overlay"
         data-action="click->mobile-sidebar#close"
         class="fixed inset-0 z-40 bg-black/50 backdrop-blur-sm hidden lg:hidden"></div>

    <!-- Mobile sidebar -->
    <aside data-mobile-sidebar-target="sidebar"
           class="fixed inset-y-0 left-0 z-50 w-60 bg-white border-r border-gray-200 transform -translate-x-full transition-transform duration-200 lg:hidden">
      <div class="flex h-14 items-center border-b border-gray-200 px-6">
        <svg class="w-6 h-6 text-teal-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span class="text-sm font-bold text-gray-900 tracking-tight">Finance Hub</span>
      </div>
      <nav class="flex flex-col gap-1 p-3" data-action="click->mobile-sidebar#close">
        <%= sidebar_link "Dashboard", root_path, icon_dashboard %>
        <%= sidebar_link "Accounts", accounts_path, icon_accounts %>
        <%= sidebar_link "Performance", performance_path, icon_performance %>
        <%= sidebar_link "Import", import_path, icon_import %>
        <%= sidebar_link "Settings", settings_path, icon_settings %>
      </nav>
    </aside>

    <!-- Desktop sidebar -->
    <aside class="fixed inset-y-0 left-0 z-30 hidden w-60 border-r border-gray-200 bg-white lg:block">
      <div class="flex h-14 items-center border-b border-gray-200 px-6">
        <svg class="w-6 h-6 text-teal-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span class="text-sm font-bold text-gray-900 tracking-tight">Finance Hub</span>
      </div>
      <nav class="flex flex-col gap-1 p-3">
        <%= sidebar_link "Dashboard", root_path, icon_dashboard %>
        <%= sidebar_link "Accounts", accounts_path, icon_accounts %>
        <%= sidebar_link "Performance", performance_path, icon_performance %>
        <%= sidebar_link "Import", import_path, icon_import %>
        <%= sidebar_link "Settings", settings_path, icon_settings %>
      </nav>
    </aside>

    <!-- Main area -->
    <div class="lg:pl-60">
      <!-- Sticky topbar -->
      <header class="sticky top-0 z-20 flex h-14 items-center justify-between border-b border-gray-200 bg-white/95 backdrop-blur px-4 lg:px-6">
        <button data-action="mobile-sidebar#toggle" class="lg:hidden p-1.5 -ml-1.5 rounded-lg text-gray-500 hover:bg-gray-100">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </button>

        <div class="flex-1"></div>

        <div class="flex items-center gap-3">
          <!-- Currency selector -->
          <div data-controller="currency-selector" class="relative">
            <button data-action="currency-selector#toggle" data-currency-selector-target="button"
                    class="flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium text-gray-500 hover:bg-gray-100 transition-colors">
              <span data-currency-selector-target="label"><%= session[:display_currency] || "USD" %></span>
              <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div data-currency-selector-target="dropdown" class="hidden absolute right-0 mt-1 w-24 bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-50">
              <%= link_to "USD", settings_update_display_currency_path(currency: "USD"), method: :patch, class: "block px-3 py-1.5 text-xs text-gray-700 hover:bg-gray-50", data: { turbo_method: :patch } %>
              <%= link_to "INR", settings_update_display_currency_path(currency: "INR"), method: :patch, class: "block px-3 py-1.5 text-xs text-gray-700 hover:bg-gray-50", data: { turbo_method: :patch } %>
            </div>
          </div>

          <!-- Notification bell -->
          <div data-controller="notification-bell" class="relative">
            <button data-action="notification-bell#toggle" class="p-1.5 rounded-lg text-gray-500 hover:bg-gray-100 relative">
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
              </svg>
              <span data-notification-bell-target="badge" class="hidden absolute -top-0.5 -right-0.5 w-4 h-4 bg-red-500 rounded-full text-[10px] font-bold text-white flex items-center justify-center"></span>
            </button>
            <div data-notification-bell-target="dropdown" class="hidden absolute right-0 mt-2 w-80 bg-white border border-gray-200 rounded-xl shadow-lg z-50 overflow-hidden">
              <div class="flex items-center justify-between px-4 py-3 border-b border-gray-100">
                <span class="text-sm font-semibold text-gray-900">Notifications</span>
                <button data-action="notification-bell#markAllRead" class="text-xs text-teal-600 hover:text-teal-700 font-medium">Mark all read</button>
              </div>
              <div data-notification-bell-target="list" class="max-h-80 overflow-y-auto">
                <p class="p-4 text-sm text-gray-400 text-center">No notifications</p>
              </div>
            </div>
          </div>

          <span class="text-xs text-gray-400"><%= current_user&.email rescue "user" %></span>

          <%= link_to "Sign out", "/auth/logout", class: "text-xs text-gray-400 hover:text-gray-600", data: { turbo: false } %>
        </div>
      </header>

      <main class="p-4 lg:p-6">
        <% if notice %>
          <div class="mb-4 p-3 bg-emerald-50 text-emerald-700 border border-emerald-200 rounded-lg text-sm"><%= notice %></div>
        <% end %>
        <% if alert %>
          <div class="mb-4 p-3 bg-red-50 text-red-700 border border-red-200 rounded-lg text-sm"><%= alert %></div>
        <% end %>
        <%= yield %>
      </main>
    </div>
  </body>
</html>
